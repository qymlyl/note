"use strict";(self.webpackChunkstudy_note=self.webpackChunkstudy_note||[]).push([[19],{3905:(e,n,s)=>{s.d(n,{Zo:()=>d,kt:()=>_});var r=s(7294);function l(e,n,s){return n in e?Object.defineProperty(e,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[n]=s,e}function t(e,n){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),s.push.apply(s,r)}return s}function a(e){for(var n=1;n<arguments.length;n++){var s=null!=arguments[n]?arguments[n]:{};n%2?t(Object(s),!0).forEach((function(n){l(e,n,s[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):t(Object(s)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(s,n))}))}return e}function o(e,n){if(null==e)return{};var s,r,l=function(e,n){if(null==e)return{};var s,r,l={},t=Object.keys(e);for(r=0;r<t.length;r++)s=t[r],n.indexOf(s)>=0||(l[s]=e[s]);return l}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(r=0;r<t.length;r++)s=t[r],n.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(l[s]=e[s])}return l}var p=r.createContext({}),c=function(e){var n=r.useContext(p),s=n;return e&&(s="function"==typeof e?e(n):a(a({},n),e)),s},d=function(e){var n=c(e.components);return r.createElement(p.Provider,{value:n},e.children)},i="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var s=e.components,l=e.mdxType,t=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),i=c(s),u=l,_=i["".concat(p,".").concat(u)]||i[u]||m[u]||t;return s?r.createElement(_,a(a({ref:n},d),{},{components:s})):r.createElement(_,a({ref:n},d))}));function _(e,n){var s=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var t=s.length,a=new Array(t);a[0]=u;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[i]="string"==typeof e?e:l,a[1]=o;for(var c=2;c<t;c++)a[c]=s[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,s)}u.displayName="MDXCreateElement"},6773:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>p,contentTitle:()=>a,default:()=>m,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var r=s(7462),l=(s(7294),s(3905));const t={id:"docker-install-wordpress",title:"Docker\u5b89\u88c5wordpress"},a=void 0,o={unversionedId:"tools/docker-install-wordpress",id:"tools/docker-install-wordpress",title:"Docker\u5b89\u88c5wordpress",description:"\u521b\u5efadocker\u5bb9\u5668",source:"@site/docs/tools/docker-install-wordpress.md",sourceDirName:"tools",slug:"/tools/docker-install-wordpress",permalink:"/note/zh-Hans/tools/docker-install-wordpress",draft:!1,tags:[],version:"current",frontMatter:{id:"docker-install-wordpress",title:"Docker\u5b89\u88c5wordpress"},sidebar:"tutorialSidebar",previous:{title:"Multipass\u5b89\u88c5\u4e0e\u4f7f\u7528",permalink:"/note/zh-Hans/tools/install-use-multipass"},next:{title:"Docker\u5b89\u88c5Mysql",permalink:"/note/zh-Hans/tools/docker-install-mysql"}},p={},c=[{value:"\u521b\u5efadocker\u5bb9\u5668",id:"\u521b\u5efadocker\u5bb9\u5668",level:2},{value:"\u521b\u5efa\u5de5\u4f5c\u76ee\u5f55",id:"\u521b\u5efa\u5de5\u4f5c\u76ee\u5f55",level:3},{value:"\u7f16\u5199docker-compose.yml\u6587\u4ef6",id:"\u7f16\u5199docker-composeyml\u6587\u4ef6",level:3},{value:"\u521b\u5efa\u5bb9\u5668",id:"\u521b\u5efa\u5bb9\u5668",level:3},{value:"\u8bbf\u95ee\u9875\u9762",id:"\u8bbf\u95ee\u9875\u9762",level:3},{value:"\u5bb9\u5668\u5220\u9664",id:"\u5bb9\u5668\u5220\u9664",level:3},{value:"wordpress\u914d\u7f6e",id:"wordpress\u914d\u7f6e",level:2},{value:"\u4e0a\u4f20\u5927\u5c0f\u9650\u5236",id:"\u4e0a\u4f20\u5927\u5c0f\u9650\u5236",level:3},{value:"nginx \u914d\u7f6e",id:"nginx-\u914d\u7f6e",level:2},{value:"\u8bc1\u4e66\u751f\u6210",id:"\u8bc1\u4e66\u751f\u6210",level:3},{value:"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6",id:"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6",level:3},{value:"navicate\u8fde\u63a5mysql\u62a5\u9519",id:"navicate\u8fde\u63a5mysql\u62a5\u9519",level:2}],d={toc:c},i="wrapper";function m(e){let{components:n,...s}=e;return(0,l.kt)(i,(0,r.Z)({},d,s,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"\u521b\u5efadocker\u5bb9\u5668"},"\u521b\u5efadocker\u5bb9\u5668"),(0,l.kt)("h3",{id:"\u521b\u5efa\u5de5\u4f5c\u76ee\u5f55"},"\u521b\u5efa\u5de5\u4f5c\u76ee\u5f55"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir -p ~/opt/wordpress\n")),(0,l.kt)("h3",{id:"\u7f16\u5199docker-composeyml\u6587\u4ef6"},"\u7f16\u5199docker-compose.yml\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd ~/opt/wordpress\n")),(0,l.kt)("p",null,"\u7f16\u5199docker-compose.yml"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"vim docker-compose.yml\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.9"\nservices:\n  wordpress_db:\n    image: mysql:8.1\n    container_name: wordpress_db\n    environment:\n      # root\u7528\u6237\u5bc6\u7801\n      MYSQL_ROOT_PASSWORD: 123qaz@Admin\n      # wordpress\u6240\u8981\u4f7f\u7528\u7684\u6570\u636e\u5e93\n      MYSQL_DATABASE: wordpress\n      # wordpress\u6240\u8981\u4f7f\u7528\u7684\u7528\u6237\n      MYSQL_USER: wordpress_user\n      MYSQL_PASSWORD: 123qaz@Wordpress_user\n    ports:\n      - "13306:3306"\n    volumes:\n      - ./volumes/mysql:/var/lib/mysql\n    restart: always\n  wordpress:\n    depends_on:\n      - wordpress_db\n    # wordpress:6.3.1-php8.2-apache\n    image: wordpress\n    container_name: wordpress\n    environment:\n      # wordpress\u8fde\u63a5\u7684\u5bb9\u5668\n      WORDPRESS_DB_HOST: wordpress_db\n      # wordpress\u6240\u8981\u4f7f\u7528\u7684\u6570\u636e\u5e93\n      WORDPRESS_DB_NAME: wordpress\n      # wordpress\u6240\u8981\u4f7f\u7528\u7684\u7528\u6237\n      WORDPRESS_DB_USER: wordpress_user\n      WORDPRESS_DB_PASSWORD: 123qaz@Wordpress_user\n    ports:\n      - 8080:80\n    volumes:\n      - ./volumes/wordpress/html:/var/www/html\n    restart: always\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'  nginx:\n    depends_on:\n      - wordpress\n    image: nginx\n    container_name: wordpress_nginx\n    volumes:\n      - ./volumes/nginx/html:/usr/share/nginx/html\n      - ./volumes/nginx/conf.d:/etc/nginx/conf.d\n      - ./volumes/nginx/logs:/var/log/nginx\n    links:\n      - wordpress\n    ports:\n      - "80:80"\n      - "443:443"\n    restart: always\n')),(0,l.kt)("h3",{id:"\u521b\u5efa\u5bb9\u5668"},"\u521b\u5efa\u5bb9\u5668"),(0,l.kt)("p",null,"\u540e\u53f0\u542f\u52a8\u5bb9\u5668"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"# wordpress_container\u662f\u5bb9\u5668\u540d\u79f0\u516c\u5171\u524d\u7f00\ndocker-compose -p wordpress_container up -d\n")),(0,l.kt)("p",null,"\u67e5\u770b\u5bb9\u5668\u8fdb\u7a0b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'$ docker ps -a\nCONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                                                    NAMES\na5aee2a31104   wordpress   "docker-entrypoint.s\u2026"   15 seconds ago   Up 14 seconds   0.0.0.0:8080->80/tcp, :::8080->80/tcp                    wordpress\n1fc79d23ec2e   mysql:8.1   "docker-entrypoint.s\u2026"   15 seconds ago   Up 14 seconds   33060/tcp, 0.0.0.0:13306->3306/tcp, :::13306->3306/tcp   wordpress_db\n')),(0,l.kt)("h3",{id:"\u8bbf\u95ee\u9875\u9762"},"\u8bbf\u95ee\u9875\u9762"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"# \u8fd9\u91cc\u662f\u865a\u62df\u673a\u7684\u5185\u7f51\u4e4b\u5730\nhttp://10.211.55.3:8080/\n")),(0,l.kt)("h3",{id:"\u5bb9\u5668\u5220\u9664"},"\u5bb9\u5668\u5220\u9664"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"docker-compose -p wordpress_container down\n")),(0,l.kt)("h2",{id:"wordpress\u914d\u7f6e"},"wordpress\u914d\u7f6e"),(0,l.kt)("h3",{id:"\u4e0a\u4f20\u5927\u5c0f\u9650\u5236"},"\u4e0a\u4f20\u5927\u5c0f\u9650\u5236"),(0,l.kt)("p",null,"\u9ed8\u8ba4\u662f2M"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"vim ./volumes/wordpress/html/.htaccess\n")),(0,l.kt)("p",null,"\u5728",(0,l.kt)("inlineCode",{parentName:"p"},"# END WordPress"),"\u4e4b\u524d\u52a0\u4e0a\u4ee5\u4e0b\u5185\u5bb9\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"php_value upload_max_filesize 512M\nphp_value post_max_size 512M\nphp_value memory_limit 512M\n")),(0,l.kt)("p",null,"\u5237\u65b0\u9875\u9762\uff0c\u7a0b\u5e8f\u4f1a\u52a8\u6001\u52a0\u8f7d\u8be5\u914d\u7f6e"),(0,l.kt)("h2",{id:"nginx-\u914d\u7f6e"},"nginx \u914d\u7f6e"),(0,l.kt)("h3",{id:"\u8bc1\u4e66\u751f\u6210"},"\u8bc1\u4e66\u751f\u6210"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("strong",{parentName:"li"},"\u521b\u5efa\u8bc1\u4e66\u76ee\u5f55"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"mkdir -p ./volumes/nginx/conf.d/ssl\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"\u7f16\u5199opssl conf\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"vim ./volumes/nginx/conf.d/ssl/openssl.cnf\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"[ req ]\ndefault_bits = 2048\nprompt = no\ndefault_md = sha256\ndistinguished_name = dn\nreq_extensions = req_ext\nx509_extensions = cert_ext\n\n[ dn ]\nCN = mqycs.cn\n\n[ req_ext ]\nsubjectAltName = @alt_names\n\n[ cert_ext ]\nsubjectAltName = @alt_names\n\n[ alt_names ]\nDNS.1 = mqycs.cn\nDNS.2 = www.mqycs.cn\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"\u751f\u6210\u81ea\u7b7e\u540d SSL \u8bc1\u4e66\u7684\u79c1\u94a5\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl req -x509 \\\n-nodes \\\n-newkey rsa:2048 \\\n-keyout ./volumes/nginx/conf.d/ssl/mqycs.cn.key \\\n-out ./volumes/nginx/conf.d/ssl/mqycs.cn.crt \\\n-config ./volumes/nginx/conf.d/ssl/openssl.cnf \\\n-days 1825\n")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"\u67e5\u770b\u751f\u6210\u7684\u8bc1\u4e66")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"$ tree ./volumes/nginx/conf.d/ssl/\n./volumes/nginx/conf.d/ssl/\n\u251c\u2500\u2500 mqycs.cn.crt\n\u251c\u2500\u2500 mqycs.cn.key\n\u2514\u2500\u2500 openssl.cnf\n")),(0,l.kt)("h3",{id:"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6"},"\u7f16\u5199\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"cd ../\nvim nginx.conf\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"server {\n    listen 80;\n    server_name mqycs.cn www.mqycs.cn;\n\n    # \u5c06HTTP\u8bf7\u6c42\u91cd\u5b9a\u5411\u5230HTTPS\n    return 301 https://$host$request_uri;\n}\n\nserver {\n    listen 443 ssl;\n    server_name mqycs.cn www.mqycs.cn;\n\n    ssl_certificate /etc/nginx/conf.d/ssl/mqycs.cn.crt; # SSL\u8bc1\u4e66\u6587\u4ef6\u8def\u5f84\n    ssl_certificate_key /etc/nginx/conf.d/ssl/mqycs.cn.key; # SSL\u79c1\u94a5\u6587\u4ef6\u8def\u5f84\n\n    location / {\n        proxy_pass http://wordpress:80; # \u8fd9\u91cc\u7684wordpress\u662fWordPress\u5bb9\u5668\u7684\u670d\u52a1\u540d\u79f0\uff0c\u5c06\u5176\u66ff\u6362\u4e3a\u5b9e\u9645\u7684\u670d\u52a1\u540d\u79f0\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        #\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u7684\u57df\uff0c* \u4ee3\u8868\u6240\u6709\n        add_header 'Access-Control-Allow-Origin' '*';\n        #\u5141\u8bb8\u5e26\u4e0acookie\u8bf7\u6c42\n        add_header 'Access-Control-Allow-Credentials' 'true';\n        #\u5141\u8bb8\u8bf7\u6c42\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982 GET/POST/PUT/DELETE\n        add_header 'Access-Control-Allow-Methods' '*';\n        #\u5141\u8bb8\u8bf7\u6c42\u7684header\n        add_header 'Access-Control-Allow-Headers' '*';\n        #\u8fd9\u91cc\u4e0d\u80fd\u5c11\uff0c\u5426\u5219\u5bfc\u81f4JSON\u8bf7\u6c42\u8de8\u57df\u5931\u8d25\n        if ($request_method = 'OPTIONS') {\n            return 204;\n        }\n    }\n        # \u8bbe\u7f6e\u8bf7\u6c42\u4f53\u5927\u5c0f\u9650\u5236\u4e3a1024MB\n        client_max_body_size 1024M; \n        \n    # \u6dfb\u52a0\u5176\u4ed6SSL\u76f8\u5173\u914d\u7f6e\uff0c\u5982SSL\u534f\u8bae\u7248\u672c\u548c\u52a0\u5bc6\u5957\u4ef6\n    ssl_protocols TLSv1.2 TLSv1.3; # \u4ec5\u542f\u7528TLS 1.2\u548cTLS 1.3\uff0c\u5efa\u8bae\u4e0d\u518d\u4f7f\u7528\u65e7\u7684TLS\u7248\u672c\n        ssl_prefer_server_ciphers on;\n        \n    # \u4f7f\u7528\u8f83\u5b89\u5168\u7684\u52a0\u5bc6\u5957\u4ef6\uff0c\u8fd9\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u63a8\u8350\u914d\u7f6e\n    ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';\n\n    # \u542f\u7528OCSP Stapling\u4ee5\u63d0\u9ad8\u5b89\u5168\u6027\u548c\u6027\u80fd\n    ssl_stapling on;\n\n    # \u914d\u7f6eSSL\u4f1a\u8bdd\u7f13\u5b58\u4ee5\u63d0\u9ad8\u6027\u80fd\n    ssl_session_cache shared:SSL:5m;\n    ssl_session_timeout 5m;\n}\n")),(0,l.kt)("h2",{id:"navicate\u8fde\u63a5mysql\u62a5\u9519"},"navicate\u8fde\u63a5mysql\u62a5\u9519"),(0,l.kt)("p",null,"\u4ee5\u7ba1\u7406\u5458\u8eab\u4efd\u6253\u5f00dos\u7a97\u53e3\uff0c\u8fde\u63a5mysql\u6570\u636e\u5e93"),(0,l.kt)("p",null,"\u67e5\u770b\u5f53\u524d\u7528\u6237\u52a0\u5bc6\u65b9\u5f0f\uff1a"),(0,l.kt)("p",null,"use mysql"),(0,l.kt)("p",null,"select user,plugin from user;"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"mysql> select user,plugin from user;\n+------------------+-----------------------+\n| user             | plugin                |\n+------------------+-----------------------+\n| root             | caching_sha2_password |\n| wordpress_user   | caching_sha2_password |\n| mysql.infoschema | caching_sha2_password |\n| mysql.session    | caching_sha2_password |\n| mysql.sys        | caching_sha2_password |\n| root             | caching_sha2_password |\n+------------------+-----------------------+\n")),(0,l.kt)("p",null,"\u5c06\u7528\u6237\u7684\u52a0\u5bc6\u65b9\u5f0f\u6539\u4e3amysql_native_password\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u4fee\u6539\u52a0\u5bc6\u89c4\u5219\nALTER USER 'root'@'%' IDENTIFIED BY '123qaz@Admin' PASSWORD EXPIRE NEVER;\n# \u91cd\u7f6e\u5bc6\u7801\nALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '123qaz@Admin';\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"# \u4fee\u6539\u52a0\u5bc6\u89c4\u5219\nALTER USER 'root'@'localhost' IDENTIFIED BY '123qaz@Admin' PASSWORD EXPIRE NEVER;\n# \u91cd\u7f6e\u5bc6\u7801\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123qaz@Admin';\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"#\u5237\u65b0\u6743\u9650\nFLUSH PRIVILEGES;\n")),(0,l.kt)("p",null,"\u518d\u6b21\u67e5\u770b"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select user,plugin from user;\n+------------------+-----------------------+\n| user             | plugin                |\n+------------------+-----------------------+\n| root             | mysql_native_password |\n| wordpress_user   | caching_sha2_password |\n| mysql.infoschema | caching_sha2_password |\n| mysql.session    | caching_sha2_password |\n| mysql.sys        | caching_sha2_password |\n| root             | mysql_native_password |\n+------------------+-----------------------+\n")))}m.isMDXComponent=!0}}]);