<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-layer2/ethereum_storage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">EthStorage | qymlyl note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://qymlyl.github.io/note/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://qymlyl.github.io/note/zh-Hans/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://qymlyl.github.io/note/zh-Hans/layer2/ethereum_storage"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="EthStorage | qymlyl note"><meta data-rh="true" name="description" content="概述"><meta data-rh="true" property="og:description" content="概述"><link data-rh="true" rel="icon" href="/note/zh-Hans/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://qymlyl.github.io/note/zh-Hans/layer2/ethereum_storage"><link data-rh="true" rel="alternate" href="https://qymlyl.github.io/note/layer2/ethereum_storage" hreflang="en"><link data-rh="true" rel="alternate" href="https://qymlyl.github.io/note/zh-Hans/layer2/ethereum_storage" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://qymlyl.github.io/note/layer2/ethereum_storage" hreflang="x-default"><link rel="stylesheet" href="/note/zh-Hans/assets/css/styles.75314c4a.css">
<link rel="preload" href="/note/zh-Hans/assets/js/runtime~main.4c2e441e.js" as="script">
<link rel="preload" href="/note/zh-Hans/assets/js/main.7f2867a2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/note/zh-Hans/"><div class="navbar__logo"><img src="/note/zh-Hans/img/logo.svg" alt="qymlyl note Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/note/zh-Hans/img/logo.svg" alt="qymlyl note Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">qymlyl note</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/note/zh-Hans/home">首页</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/note/zh-Hans/tools/ubuntu-usage">工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/note/zh-Hans/ethereum/whitepaper">以太坊</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/note/zh-Hans/layer2/scroll_architecture">Layer2学习</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/zh-Hans/layer2/scroll_architecture">Scroll整体架构和主要流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/note/zh-Hans/layer2/polygon_zkevm_architecture">Polygon整体架构和主要流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/note/zh-Hans/layer2/ethereum_storage">EthStorage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/note/zh-Hans/zkp_study/zkp_history">zkp学习</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/note/zh-Hans/risc-v/ubuntu-install-riscv-gnu-toolchain">risc-v</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/note/zh-Hans/rust/little-tools">Rust</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/note/zh-Hans/rCore-Tutorial-Book学习/ch1-setup-os-devel-env">rCore-Tutorial-Book学习</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/note/zh-Hans/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Layer2学习</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">EthStorage</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>EthStorage</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题出现原因">问题出现原因<a href="#问题出现原因" class="hash-link" aria-label="问题出现原因的直接链接" title="问题出现原因的直接链接">​</a></h3><p> 2023年10月22日，著名的 Go-Ethereum（Geth）开发负责人 Péter Szilágyi 在 Twitter 上表达了他对以太坊数据存储方案的担忧。他指出，虽然 Geth 客户端保留了所有历史数据，但 Nethermind 和 Besu 等其他类型的以太坊客户端，可以配置删除某些以太坊历史数据（例如历史区块）。这会让部分客户端节点的行为与其他客户端不一致，对Geth客户端运行者来说很不公平。上述话题随即引发了关于以太坊路线图中存储方案的激烈讨论。</p><p>下面的饼图展示了截至2023 年 12 月 13 日时，区块高度为18,779,761下，一个新 Geth 节点的存储分布情况：</p><p><img loading="lazy" alt="图片" src="/note/zh-Hans/assets/images/geth_storage_data-909b1eb80f0ed93cfbc0c99350faeb14.png" width="673" height="407" class="img_ev3q"></p><ul><li>总存储大小：925.39 GB</li><li>历史数据（区块/交易收据）：约 628.69 GB</li><li>Merkle Patricia Trie (MPT) 中的状态数据：约 269.74 G</li></ul><p>当存储成本成为节点的重大负担时，一些节点运营商选择删除历史数据就不足为奇。<strong>在没有历史数据的情况下，节点客户端可以显著降低存储成本，将占用的存储空间从大约 1TB 减少到 300GB 左右。</strong></p><p>客户端运行者可以自由地删除或修改所有历史数据，而不会受到任何惩罚。相比之下，Validator节点必须在本地维护并更新完整的状态，以防止因提议/投票支持无效区块而被Slash（安全和惩罚机制）。</p><p>主要问题：</p><ul><li>以太坊客户端的存储要求变多越来越高(数据量越来越大)</li><li>存储以太坊历史数据没有任何的协议内的激励或者惩罚</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="未来的挑战">未来的挑战<a href="#未来的挑战" class="hash-link" aria-label="未来的挑战的直接链接" title="未来的挑战的直接链接">​</a></h3><p>随着即将到来的以太坊数据可用性（DA）升级，存储挑战将会加剧。全面扩容以太坊 DA 的道路始于 DenCun 升级中的 EIP-4844，它引入了一个固定大小的二进制大对象 (BLOB) ，和一个被称为 blobGasPrice 的独立费用模型。每个 BLOB 设置为 128KB，EIP-4844 实行后，每个区块最多包含6个BLOB。为了对数据吞吐量进行扩容，以太坊计划采用 1D Reed-Solomon 纠删码，最初允许每个区块有 32 个 BLOB，并在完全扩容时达到每个区块 256 个 BLOB 的量级（逐步升级中）。</p><p><strong>如果以太坊 DA 以全容量运行（每个块 256 个 BLOB），以太坊 DA 网络预计一年将接收大约 80 TB 的DA数据，该数字远远超出大多数节点的存储能力</strong>。</p><p><strong>即随着以太坊节点的数据量越来越大，存储成本越来越高，可能会有更多的客户端选择删除以太坊的某些历史数据(历史区块)。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="删除历史数据的后果">删除历史数据的后果<a href="#删除历史数据的后果" class="hash-link" aria-label="删除历史数据的后果的直接链接" title="删除历史数据的后果的直接链接">​</a></h3><p>不断上升的存储成本引起了以太坊生态研究人员的关注。为了解决这个问题并确保所有客户端的一致性，<strong>研究人员正在制定一些提案来明确删除以太坊客户端的历史数据。</strong>两个主要提案是：</p><p><strong>·</strong> EIP-4444：限制执行客户端中的历史数据：该提案允许客户端删除超过一年的过往区块。假设平均区块大小为 100K，历史块数据上限约为 250 GB（100K <em> (3600 </em> 24 * 365) / 12，假设区块时间 = 12 秒）。</p><p><strong>·</strong> EIP-4844：分片 BLOB 交易：丢弃超过 18 天的 BLOB数据。与 EIP-4444 相比，这是一种更激进的方法，将历史 BLOB 大小限制在 100 GB 左右（(18 <em> 3600 </em> 24) <em> 128K </em> 6 / 12，假设区块时间 = 12 秒）。</p><p><strong>删除所有客户端的历史数据会产生什么后果？</strong>主要的一个问题是，新节点无法通过“full sync”模式来同步到最新状态， “full sync”是一种将历史数据重放，从创世区块同步到最新区块的数据同步方案。相应地，我们必须采取“snap sync”或“state sync”来直接同步以太坊节点的最新状态。这种方法已在 Geth 中实现，并作为默认的同步运行方式。</p><p><strong>节点删除掉以太坊主网历史数据，也会导致以太坊 L2出现问题</strong>，即新加入的Layer2节点，无法通过重放 Layer2全部历史数据的方法，同步至当前的最新状态。此外，由于 L1 节点不维护 L2 状态，L2 的“snap sync”方法无法根据Layer1区块直接派生出最新的 Layer2 状态，这违反了Layer2继承以太坊安全所需的重要假设。</p><p><strong>以太坊需要有一个存储层，而且是一个去中心化的、不需要对以太坊本身的协议进行升级的一个存储层，或者我们叫模块化的存储层来解决数据的长期保存问题。</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="去中心存储概述">去中心存储概述<a href="#去中心存储概述" class="hash-link" aria-label="去中心存储概述的直接链接" title="去中心存储概述的直接链接">​</a></h2><p>随着Web3的发展，越来越多属于Web3的数据被挖掘和产生，而这些数据往往被存储在web2的中心化的存储平台上，但是这往往会带来额外的问题，例如中心化服务器的崩溃导致数据丢失，数据审查等问题。</p><p>因此去中心化存储也孕育而生，跟中心化存储不同的是，提供数据存储服务的数据节点网络，是通过p2p网络进行网络通信和数据同步的，并且任何人都可以无许可( permissionless )的加入这个网络，成为网络中的一个数据节点 。</p><p>从用户端而言，任何用户都可以无许可地存储任何你想存储的数据，只要为数据支付相应的存储费用；最终存储的数据会以多个副本的形式保存在网络内，因此也基本上避免了数据丢失的可能性(容灾性好)。</p><p>读取数据的时候，用户的读取请求会由p2p网络进行转发，最终存储了该数据的数据节点会响应该读取请求</p><p><strong>设计去中心化存储需要考虑的几个问题：</strong></p><ol><li>一个节点如何高效地证明它完整的存储了一个数据分片的数据？</li><li>如何给节点发放存储奖励？</li><li>在这个系统下，怎么保证存储的数据不丢失？或者说怎么保证这份数据有足够保证安全的副本数量？</li><li>如何让每份数据的副本数量基本保持一致？</li><li>收费标准</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ethstorage网络">EthStorage网络<a href="#ethstorage网络" class="hash-link" aria-label="EthStorage网络的直接链接" title="EthStorage网络的直接链接">​</a></h2><blockquote><p>官网：<a href="https://eth-store.w3eth.io/#/" target="_blank" rel="noopener noreferrer">https://eth-store.w3eth.io/#/</a></p><p>EthStorage: <a href="https://file.w3q.w3q-g.w3link.io/0x67d0481cc9c2e9dad2987e58a365aae977dcb8da/dynamic_data_sharding_0_1_6.pdf" target="_blank" rel="noopener noreferrer">https://file.w3q.w3q-g.w3link.io/0x67d0481cc9c2e9dad2987e58a365aae977dcb8da/dynamic_data_sharding_0_1_6.pdf</a></p><p>EthStorage存储流程和原理：<a href="https://ethstorage-cn.medium.com/ethstorage-%E7%AC%AC%E4%B8%80%E4%B8%AAethereum%E5%AD%98%E5%82%A8l2-306aaca6569b" target="_blank" rel="noopener noreferrer">https://ethstorage-cn.medium.com/ethstorage-%E7%AC%AC%E4%B8%80%E4%B8%AAethereum%E5%AD%98%E5%82%A8l2-306aaca6569b</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-1">概述<a href="#概述-1" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3><p>一个无需许可的去中心化的Layer2数据存储网络。支持通过部署在以太坊主网合约上对存储的数据进行完整的CRUD，支持PB级别的数据存储。</p><p>优势：</p><ul><li>丰富的存储语义（KV CRUD）。 FILECOIN/AR 主要适用于静态文件，缺乏高效的更新/删除操作 — — 即，用户必须支付两次费用才能更新现有数据。而得益于数据可用（DA）和智能合约，EthStorage 可以提供类似于 SSTORE 的完整 KV CRUD 语义。</li><li>可编程性。存储可以通过智能合约进行编程，这便可以很容易的启用新功能，例如多用户访问控制或数据可组合性。</li></ul><p>我们的早期分析表明，与通过 SSTORE 操作码完全复制的 EVM 原生 KV 存储相比，存储大值的成本可以降低至约 1/100 倍，同时确保网络中存在数十或数百个值的副本。  --- Decentralized Storage on Large Dynamic Datasets with Applications for Large Decentralized KV Store。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本架构">基本架构<a href="#基本架构" class="hash-link" aria-label="基本架构的直接链接" title="基本架构的直接链接">​</a></h3><p><img loading="lazy" alt="img" src="/note/zh-Hans/assets/images/ethstorage_arch-749af59ccbf29990698c50da017c824d.png" width="1400" height="741" class="img_ev3q"></p><p>EthStorage 的客户端是以太坊客户端 Geth的<strong>超集</strong>，这运行EthStorage的节点的时候，依然可以正常参与以太坊的任何流程。</p><p>当启动一个EthStorage Node的时候，实际上是运行着一个 Geth 和 Data Provider 的结合体，内部运行的 Geth 可以保证节点正常参与以太坊网络，例如，一个节点可以是以太坊的验证者节点的同时也是EthStorage的数据节点。</p><p>每个 EthStorage Node 的 Data Provider 模块会跟其他 EthStorage Node 的 Data Provider 发起建立连接请求，当它们互相连接之后，实际上就构成了一个去中心化存储网络。</p><p><strong>橙色网络</strong>代表去中心化的以太坊网络，<strong>绿色网络</strong>代表由EthStorage支持的去中心化存储网络。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="crud">CRUD<a href="#crud" class="hash-link" aria-label="CRUD的直接链接" title="CRUD的直接链接">​</a></h3><p>EthStorage在以太坊主网上部署有智能合约来支持CRUD</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">contract</span><span class="token plain"> </span><span class="token class-name">DecentralizedKV</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">bytes32</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">payable</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">bytes32</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">uint256</span><span class="token plain"> off</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">uint256</span><span class="token plain"> len</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">view</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">bytes32</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token builtin">bytes32</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token builtin">bytes</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">memory</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">view</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">bool</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>put : 这是一个写数据的方法(新增或者更新)，调用这个方法会将给定的数据 (data) 存储在我们对应的数据分片(shard)中，并且你可以在读取方法中通过对应的 key 读到它。</li><li>get : 这是一个查询方法，调用这个方法可以进行获取要查询的 key 的对应数据。</li><li>remove : 这是一个删除数据的方法，调用这个方法可以会删除key对应的数据。</li><li>verify: 这是一个验证方法，可以检查分片(shard)中存储的数据的数据哈希是否是跟合约内的数据哈希匹配，如果匹配证明链下存储的数据是正确的。</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="put增">Put(增)<a href="#put增" class="hash-link" aria-label="Put(增)的直接链接" title="Put(增)的直接链接">​</a></h4><p><img loading="lazy" alt="img" src="/note/zh-Hans/assets/images/ethstorage_data_add_01-c01626fce3eb32604f31734fe4232984.png" width="1400" height="638" class="img_ev3q"></p><p><img loading="lazy" alt="img" src="/note/zh-Hans/assets/images/ethstorage_data_add02-ade280bd67b01dac1c5f72c44383d39c.png" width="1400" height="434" class="img_ev3q"></p><p>保存数据到EthStorage是通过调用合约中的<code>put(bytes32 key, bytes memory data)</code>方法进行的，当用户填写key和data之后，发起一笔以太坊交易，合约执行回计算dataHash和keyIdx，并将dataHash和keyIdx进行保存，当EthStorage的客户端ShardManager坚挺到有新的Put交易发生，将会根据keyIdx将data保存到对应的数据分片中。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="put改">Put(改)<a href="#put改" class="hash-link" aria-label="Put(改)的直接链接" title="Put(改)的直接链接">​</a></h4><p><img loading="lazy" alt="img" src="/note/zh-Hans/assets/images/ethstorage_data_update-280e7e72334569ac62196b365285dc6f.png" width="1400" height="638" class="img_ev3q"></p><p>当用户需要更新存储在 EthStorage上的数据的时候，通过发起一笔以太坊调用合约的交易，来执行 put 方法:</p><p>● 调用方法put( key , new_data )：</p><ul><li><p>key: 用户之前存储数据对应的key</p></li><li><p>new_data: 用户希望存储的新数据</p></li></ul><p>● 更新数据的执行流程跟存储数据流程基本差不多，具体如下:</p><ol><li>用户发起一笔调用合约put方法的交易: submit Tx{ put( key , new_data ) };</li><li>这笔交易会将记录在合约中对应的key的哈希更新: dataHash = hash(new_data)；</li><li>EthStorage客户端 的 ShardManager 监听到有新的 put 交易发生，获取到 put方法中携带的要更新的数据 new_data;</li><li>ShardManager 将要更新的数据进行mask(密封)之后替换之前存储的数据；store( kvIdx , mask(new_data))</li></ol><p>图中标注为红色方格的数据，是update过程中被修改的数据。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="get">Get<a href="#get" class="hash-link" aria-label="Get的直接链接" title="Get的直接链接">​</a></h4><p>调用 <code>get(key)</code> ，可以通过key找到对应的kvIdx，然后根据kvIdx向数据节点发送读取请求，数据节点判断该kvIdx对应的数据是刚好在自己存储的数据分片中的时候，会向用户回复请求的数据；如果矿工没有存储对应数据，则会帮助用户转发读取数据的请求。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="remove">Remove<a href="#remove" class="hash-link" aria-label="Remove的直接链接" title="Remove的直接链接">​</a></h4><p><img loading="lazy" alt="img" src="/note/zh-Hans/assets/images/ethstorage_data_delete-716d1b4534c2b836154c80a92de8c938.png" width="1400" height="1122" class="img_ev3q"></p><p>假如：KeyA 对应的kvIdx为1 ，用户此时要将KeyA对应的数据移除；当前最大的kvIdx对应的键为KeyB</p><p>● 调用方法:remove(key)</p><ul><li>key: 你想要删除数据的索引key</li></ul><p>● 删除步骤：</p><ol><li>发起一笔调用remove方法的交易: submit Tx{ remove(KeyA) };</li><li>ShardManager 将KeyB对应的数据读出来之后，复制到KeyA的数据存储位置: copy(chunkIdx(KeyA), readMasked(keyB));</li><li>ShardManager 将KeyB的数据( chunk99 )删除: delete(chunk99);</li><li>合约 将 KeyB 对应的 kvIdx 从 99 改为 1: updateKvIdx(KeyB, 1);</li><li>合约 将 lastKVIdx 由 99 改为 98: lastKvIdx =lastKvIdx — 1;</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="verify">verify<a href="#verify" class="hash-link" aria-label="verify的直接链接" title="verify的直接链接">​</a></h4><p>核心原理是 EthStorage 会在合约内记录 key 所对应数据的哈希，在每次进行随机访问证明(Proof-of-Random-Access) 的时候会将矿工上传的数据进行哈希，然后与合约内存储的数据数据哈希进行验证，只有合约内存储的数据哈希和上传的数据哈希相等，随机访问证明才会生成一个有效的证明。</p><p>激励机制</p><p>随机访问证明(roof-of-Random-Access)</p><p>可用证明它完整的存储了一个数据分片的数据</p><p>问题：存储费用怎么收取， ETH？</p><p>当调用 put() 方法时，交易必须发送存储费（通过 msg.value）并存入合约中。在成功链下存储节点提交并验证存储证明后，这个存储费用将随着时间的推移逐渐分配给存储节点。</p><p>如果对普通的geth执行get</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="以太坊-portal-network">以太坊 Portal Network<a href="#以太坊-portal-network" class="hash-link" aria-label="以太坊 Portal Network的直接链接" title="以太坊 Portal Network的直接链接">​</a></h2><blockquote><p>官网：<a href="https://www.ethportal.net/" target="_blank" rel="noopener noreferrer">https://www.ethportal.net/</a></p><p>官网的FAQ: <a href="https://www.ethportal.net/resources/faq" target="_blank" rel="noopener noreferrer">https://www.ethportal.net/resources/faq</a></p><p>Portal Network 标准：<a href="https://github.com/ethereum/portal-network-specs" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/portal-network-specs</a></p><p>简单介绍：<a href="https://ethereum.org/zh/developers/docs/networking-layer/portal-network/" target="_blank" rel="noopener noreferrer">https://ethereum.org/zh/developers/docs/networking-layer/portal-network/</a></p><p>简单视频介绍：<a href="https://www.youtube.com/watch?v=0stc9jnQLXA" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=0stc9jnQLXA</a></p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述-2">概述<a href="#概述-2" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h3><p>以太坊用户有两种选择：</p><ul><li>投入大量的计算资源和带宽来运行以太坊节点（存储成本高）</li><li>信任中心化第三方（例如 RPC 提供商）来提供以太坊数据（可能需要收取费用）</li></ul><p>Portal Network 为以太坊用户引入了第三种选择：</p><ul><li>以分散的方式访问以太坊数据，且硬件和带宽要求最低（手机或 Raspberry Pi 设备也有可能加入该网络）。</li></ul><p>Portal Network是一种与以太坊并行运行的点对点协议。以太坊数据<strong>分布在整个门户网络中</strong>，而不是在每个单独的节点中复制。这使得用户能够以最少的硬件和带宽要求访问以太坊数据，并且几乎可以即时同步。</p><p>传统方式：</p><p><img loading="lazy" alt="image-20240425162008816" src="/note/zh-Hans/assets/images/portal_network_traditional_eth_data_get-4dec6839569bef856863972b572c9f35.png" width="1295" height="644" class="img_ev3q"></p><p>protal network</p><p><img loading="lazy" alt="image-20240425162133963" src="/note/zh-Hans/assets/images/portal_network_data_get-31db56a4b10a5619bf00911b89b8e630.png" width="1346" height="645" class="img_ev3q"></p><p>Portal Network 实际上是几个可以使用 Portal Network客户端访问的点对点网络（状态网络、信标网络和历史网络）。</p><p>每个网络都存储以太坊全节点存储的数据的特定子集。每个门户客户端仅存储每种类型数据的一小部分。然而，门户网络（完整的节点集）存储了从创世一直到链头的一两个区块内的<strong>所有历史以太坊数据。</strong></p><p>当从 Portal 节点请求数据时，该请求会在网络上从对等点广播到对等点，直到它最终到达存储您想要的特定信息的节点。然后该节点将响应返回给您。没有中介机构，也没有中心化的参与者需要存储大量的链上数据或处理大量的请求。</p><p>存储方式？？分布式存储，kademlia DHT</p><p>激励机制？？无，利己，为资源匮乏的用户提供获取全链数据</p><p>目前无法执行交易，没有实现对应的JSON RPC接口，可以查看<a href="https://github.com/ethereum/portal-network-specs" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/portal-network-specs</a> 中描述了实现的JSON RPC接口</p><p>为什么不是使用轻客户端通过对以太坊全节点的 RPC 调用获取数据？很少有节点运营商仅仅出于利他的原因这样做，数据是需要收费的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="问题">问题<a href="#问题" class="hash-link" aria-label="问题的直接链接" title="问题的直接链接">​</a></h3><p>一个节点如何高效地证明它完整的存储了一个数据分片的数据？</p><p>怎么保证存储的数据不丢失？或者说怎么保证这份数据有足够保证安全的副本数量？</p><p>可能需要看源码</p><p>目前所有的Portal Network还无法上生产</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="celestia-blobstream">Celestia Blobstream<a href="#celestia-blobstream" class="hash-link" aria-label="Celestia Blobstream的直接链接" title="Celestia Blobstream的直接链接">​</a></h2><p><a href="https://docs.celestia.org/developers/blobstream" target="_blank" rel="noopener noreferrer">https://docs.celestia.org/developers/blobstream</a></p><p>作为Layer2的DA</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考资料">参考资料<a href="#参考资料" class="hash-link" aria-label="参考资料的直接链接" title="参考资料的直接链接">​</a></h2><p>以太坊存储方案路线图：挑战与机遇共存：<a href="https://mp.weixin.qq.com/s/eDown8DF6w9bKfqP_URS0w" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/eDown8DF6w9bKfqP_URS0w</a></p><p>对话 EthStorage 创始人 Qi Zhou | 数据可用性和去中心化存储：<a href="https://learnblockchain.cn/article/6216" target="_blank" rel="noopener noreferrer">https://learnblockchain.cn/article/6216</a></p><p>EthStorage官网：<a href="https://eth-store.w3eth.io/#/" target="_blank" rel="noopener noreferrer">https://eth-store.w3eth.io/#/</a></p><p>EthStorage: <a href="https://file.w3q.w3q-g.w3link.io/0x67d0481cc9c2e9dad2987e58a365aae977dcb8da/dynamic_data_sharding_0_1_6.pdf" target="_blank" rel="noopener noreferrer">https://file.w3q.w3q-g.w3link.io/0x67d0481cc9c2e9dad2987e58a365aae977dcb8da/dynamic_data_sharding_0_1_6.pdf</a></p><p>EthStorage存储流程和原理：<a href="https://ethstorage-cn.medium.com/ethstorage-%E7%AC%AC%E4%B8%80%E4%B8%AAethereum%E5%AD%98%E5%82%A8l2-306aaca6569b" target="_blank" rel="noopener noreferrer">https://ethstorage-cn.medium.com/ethstorage-%E7%AC%AC%E4%B8%80%E4%B8%AAethereum%E5%AD%98%E5%82%A8l2-306aaca6569b</a></p><p>Portal Network官网：<a href="https://www.ethportal.net/" target="_blank" rel="noopener noreferrer">https://www.ethportal.net/</a></p><p>Portal Network官网的FAQ: <a href="https://www.ethportal.net/resources/faq" target="_blank" rel="noopener noreferrer">https://www.ethportal.net/resources/faq</a></p><p>Portal Network 标准：<a href="https://github.com/ethereum/portal-network-specs" target="_blank" rel="noopener noreferrer">https://github.com/ethereum/portal-network-specs</a></p><p>Portal Network简单介绍：<a href="https://ethereum.org/zh/developers/docs/networking-layer/portal-network/" target="_blank" rel="noopener noreferrer">https://ethereum.org/zh/developers/docs/networking-layer/portal-network/</a></p><p>Portal Network简单视频介绍：<a href="https://www.youtube.com/watch?v=0stc9jnQLXA" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=0stc9jnQLXA</a></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/note/zh-Hans/layer2/polygon_zkevm_architecture"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Polygon整体架构和主要流程</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/note/zh-Hans/zkp_study/zkp_history"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">了解零知识证明历史(转载)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a><ul><li><a href="#问题出现原因" class="table-of-contents__link toc-highlight">问题出现原因</a></li><li><a href="#未来的挑战" class="table-of-contents__link toc-highlight">未来的挑战</a></li><li><a href="#删除历史数据的后果" class="table-of-contents__link toc-highlight">删除历史数据的后果</a></li></ul></li><li><a href="#去中心存储概述" class="table-of-contents__link toc-highlight">去中心存储概述</a></li><li><a href="#ethstorage网络" class="table-of-contents__link toc-highlight">EthStorage网络</a><ul><li><a href="#概述-1" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#基本架构" class="table-of-contents__link toc-highlight">基本架构</a></li><li><a href="#crud" class="table-of-contents__link toc-highlight">CRUD</a></li></ul></li><li><a href="#以太坊-portal-network" class="table-of-contents__link toc-highlight">以太坊 Portal Network</a><ul><li><a href="#概述-2" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#问题" class="table-of-contents__link toc-highlight">问题</a></li></ul></li><li><a href="#celestia-blobstream" class="table-of-contents__link toc-highlight">Celestia Blobstream</a></li><li><a href="#参考资料" class="table-of-contents__link toc-highlight">参考资料</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 qymlyl note</div></div></div></footer></div>
<script src="/note/zh-Hans/assets/js/runtime~main.4c2e441e.js"></script>
<script src="/note/zh-Hans/assets/js/main.7f2867a2.js"></script>
</body>
</html>