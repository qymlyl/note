"use strict";(self.webpackChunkstudy_note=self.webpackChunkstudy_note||[]).push([[9422],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),d=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(i.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},b=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=d(n),b=r,k=u["".concat(i,".").concat(b)]||u[b]||p[b]||s;return n?a.createElement(k,o(o({ref:t},c),{},{components:n})):a.createElement(k,o({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=b;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[u]="string"==typeof e?e:r,o[1]=l;for(var d=2;d<s;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},4912:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var a=n(7462),r=(n(7294),n(3905));const s={},o=void 0,l={unversionedId:"tools/k8s_dashboard_install",id:"tools/k8s_dashboard_install",title:"k8s_dashboard_install",description:"\u5b89\u88c5k3s",source:"@site/docs/tools/k8s_dashboard_install.md",sourceDirName:"tools",slug:"/tools/k8s_dashboard_install",permalink:"/note/tools/k8s_dashboard_install",draft:!1,tags:[],version:"current",frontMatter:{}},i={},d=[{value:"\u5b89\u88c5k3s",id:"\u5b89\u88c5k3s",level:2},{value:"dashboard\u5b89\u88c5",id:"dashboard\u5b89\u88c5",level:2},{value:"\u8bbf\u95ee dashboard",id:"\u8bbf\u95ee-dashboard",level:2},{value:"\u6c49\u5316",id:"\u6c49\u5316",level:2},{value:"token",id:"token",level:2},{value:"\u5176\u4ed6\u547d\u4ee4",id:"\u5176\u4ed6\u547d\u4ee4",level:2}],c={toc:d},u="wrapper";function p(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"\u5b89\u88c5k3s"},"\u5b89\u88c5k3s"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/k3s-io/k3s/tree/v1.21.4%2Bk3s1"},"https://github.com/k3s-io/k3s/tree/v1.21.4%2Bk3s1")),(0,r.kt)("p",null,"curl -sfL ",(0,r.kt)("a",{parentName:"p",href:"https://get.k3s.io"},"https://get.k3s.io")," | INSTALL_K3S_VERSION=v1.21.4+k3s1 sh -"),(0,r.kt)("h2",{id:"dashboard\u5b89\u88c5"},"dashboard\u5b89\u88c5"),(0,r.kt)("p",null,"\u5bf9\u5e94k8s\u7248\u672c\uff1av1.21.4+k3s1"),(0,r.kt)("p",null,"GitHub: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/dashboard/tree/v2.3.1"},"https://github.com/kubernetes/dashboard/tree/v2.3.1")),(0,r.kt)("p",null,"\u4e0b\u8f7d\u90e8\u7f72\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml\n")),(0,r.kt)("p",null,"\u5b89\u88c5"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl apply -f recommended.yaml\n")),(0,r.kt)("p",null,"\u67e5\u770bdashboard\u72b6\u6001"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl get pods -n kubernetes-dashboard\nNAME                                         READY   STATUS    RESTARTS   AGE\ndashboard-metrics-scraper-856586f554-2vb4m   1/1     Running   0          28s\nkubernetes-dashboard-865bddc59c-59q5f        1/1     Running   0          28s\n")),(0,r.kt)("p",null,"\u67e5\u770bsvc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get svc -n kubernetes-dashboard\nNAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nkubernetes-dashboard        ClusterIP   10.43.181.192   <none>        443/TCP    71s\ndashboard-metrics-scraper   ClusterIP   10.43.81.128    <none>        8000/TCP   71s\n")),(0,r.kt)("p",null,"\u66b4\u9732\u7aef\u53e3\uff0c\u5c06",(0,r.kt)("inlineCode",{parentName:"p"},"type: ClusterIP"),"\u4fee\u6539\u4e3a",(0,r.kt)("inlineCode",{parentName:"p"},"type: NodePort")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl -n kubernetes-dashboard edit service kubernetes-dashboard\n")),(0,r.kt)("p",null,"\u518d\u6b21\u67e5\u770bsvc"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl get svc -n kubernetes-dashboard\nNAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\ndashboard-metrics-scraper   ClusterIP   10.43.81.128    <none>        8000/TCP        3m38s\nkubernetes-dashboard        NodePort    10.43.181.192   <none>        443:30443/TCP   3m38s\n")),(0,r.kt)("h2",{id:"\u8bbf\u95ee-dashboard"},"\u8bbf\u95ee dashboard"),(0,r.kt)("p",null,"\u60f3\u8981\u8bbf\u95eedashboard\u670d\u52a1\uff0c\u9700\u8981\u6709\u8bbf\u95ee\u6743\u9650\uff0c\u521b\u5efakubernetes-dashboard\u7ba1\u7406\u5458\u89d2\u8272"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ vim dashboard-svc-account.yaml\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: dashboard-admin\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: dashboard-admin\nsubjects:\n  - kind: ServiceAccount\n    name: dashboard-admin\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\n")),(0,r.kt)("p",null,"\u6216\u8005\u533f\u540d\u7528\u6237"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: dashboard-anonymous-admin\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: User\n  name: system:anonymous\n  apiGroup: rbac.authorization.k8s.io\n")),(0,r.kt)("p",null,"\u6267\u884c\u6587\u4ef6"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl apply -f dashboard-svc-account.yaml\nserviceaccount/dashboard-admin created\nclusterrolebinding.rbac.authorization.k8s.io/dashboard-admin created\n")),(0,r.kt)("p",null,"\u83b7\u53d6token\u6587\u4ef6\u540d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl get secret -n kube-system|grep admin|awk '{print $1}'\nadmin-service-account-token-rqczg\ndashboard-admin-token-rlqv5\n")),(0,r.kt)("p",null,"\u83b7\u53d6token"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl describe secret dashboard-admin-token-7vmj6 -n kube-system|awk '/^token/ {print $2}'\neyJhbGciOiJSUzI1NiIsImtpZCI6IkwzdTlqWWh5dUVQQnZ0WTZLTGlhcGwyOE5tVFR1d3VPNkZzWEh2dEFBYzAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tN3ZtajYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiNTQ2MTJkNDEtOTM4OS00NmVjLWFjNzgtMGNlMjkyMjI3YzA1Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.T7rPQfnyU7ZhP1L2EZkgwoIWh6CtUwUo4AZojfvBCb2dOK1XxaXunkniDWedq2ui0TE-SKKoWpswzoUeGTsSM1zgF0t62v1ImbprOgjWehINTIRm5XSvqolDwQ4Hi0HXTy3OBHCMNQ1NJtrRLEPDOAHKieKUNphj0J75GMoqxEUw7Ob0WI4vCWZod_pRAm-kjYf68FJTvXR3yXmcCam4VCa1rrnMCtQTtapogQAcJCTekC9aYku092FaASa4akpR0_5mayfBMaRGxIBgvK2DuvrF8VmLPC7-fUeW3L7GssuceFOs2WPlwOHZ-m5X8yBx-uLYx2TB_pK9FZDEHC0K5Q\n")),(0,r.kt)("p",null,"\u6d4f\u89c8\u5668\u8bbf\u95ee",(0,r.kt)("a",{parentName:"p",href:"https://192.168.0.76:30443/"},"https://192.168.0.76:30443/")," (\u6ce8\u610f\u7aef\u53e3)"),(0,r.kt)("p",null,'\u53ef\u80fd\u4f1a\u663e\u793a"\u60a8\u7684\u8fde\u63a5\u4e0d\u662f\u79c1\u5bc6\u8fde\u63a5"'),(0,r.kt)("h2",{id:"\u6c49\u5316"},"\u6c49\u5316"),(0,r.kt)("p",null,"\u4fee\u6539\u6e90\u4ee3\u7801\u4e2d\u7684i18\u4e2d\u7684\u6587\u4ef6"),(0,r.kt)("p",null,"\u4e00\u79cd\u65b9\u5f0f\u4fee\u6539",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/dashboard/tree/v2.3.1/i18n/zh-Hans%E8%AF%A5%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C"},"https://github.com/kubernetes/dashboard/tree/v2.3.1/i18n/zh-Hans\u8be5\u914d\u7f6e\u6587\u4ef6\uff0c")," \u7136\u540e\u6302\u5728\u5230\u5bb9\u5668\u4e2d"),(0,r.kt)("p",null,"\u6216\u8005\u4fee\u6539\u4e86\u4e4b\u540e\u91cd\u65b0\u6784\u9020\u955c\u50cf"),(0,r.kt)("h2",{id:"token"},"token"),(0,r.kt)("p",null,"\u95ee\u9898\uff0c\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"--kubeconfig \n")),(0,r.kt)("h2",{id:"\u5176\u4ed6\u547d\u4ee4"},"\u5176\u4ed6\u547d\u4ee4"),(0,r.kt)("p",null,"\u67e5\u770b\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\u7684deployment-name"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get deployments -n kubernetes-dashboard\nNAME                        READY   UP-TO-DATE   AVAILABLE   AGE\ndashboard-metrics-scraper   1/1     1            1           16m\nkubernetes-dashboard        1/1     1            1           16m\n")),(0,r.kt)("p",null,"\u4fee\u6539deployment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit deployment kubernetes-dashboard -n kubernetes-dashboard\n\nkubectl edit service/kubernetes-dashboard -n kubernetes-dashboard\n\n")),(0,r.kt)("p",null,"\u5220\u9664deployment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete deployment kubernetes-dashboard -n kubernetes-dashboard\n")),(0,r.kt)("p",null,"kubernetesui/dashboard:v2.3.1"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl logs kubernetes-dashboard-b4b57794-2qq7n  -n kubernetes-dashboard\n")),(0,r.kt)("p",null,"\u67e5\u770b\u6240\u6709\u7684\u547d\u540d\u7a7a\u95f4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get ns\n\nkubectl delete namespace kubernetes-dashboard\nkubectl delete namespace kuboard\n\nkubectl apply -f k8s_dashboard_recommended.yaml\n\nkubectl describe pod kubernetes-dashboard-775bd6b989-jph5f  -n kubernetes-dashboard\nkubectl logs kubernetes-dashboard-775bd6b989-7zzx7 -n kubernetes-dashboard --previous\n\nkubectl get nodes\n\nkubectl describe node ubuntu-linux-22-04-desktop\n\nkubectl get pods -n kubernetes-dashboard\n\n# --accept-hosts \u63a5\u53d7\u6240\u6709\u7684\u4e3b\u673a\u540d\nkubectl proxy --address='0.0.0.0' --port=20010 --accept-hosts='^*$'\n\n10.211.55.3\n\nkubectl get pods -n kubernetes-dashboard\nkubectl edit deployment kubernetes-dashboard -n kubernetes-dashboard\nkubectl delete deployment kubernetes-dashboard -n kubernetes-dashboard\n\nkubectl get deployments -n kubernetes-dashboard\n\nchmod 644 /etc/rancher/k3s/k3s.yaml\n\n\nkubectl exec -it kubernetes-dashboard-7f9899856b-fc5zh  -n kubernetes-dashboard -- /bin/sh\n\n\n--enable-insecure-login\n--disable-settings-authorizer\n--enable-insecure-login\n--kubeconfig \n")),(0,r.kt)("p",null,"\u95ee\u9898\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u767b\u5f55\u9875\u9762\u9700\u8981token,  \u96c6\u6210\u7684\u65f6\u5019\u9700\u8981\u53bb\u6389\uff0c\u76ee\u524d\u6ca1\u6709\u529e\u6cd5\u53bb\u9664"),(0,r.kt)("li",{parentName:"ol"},"\u767b\u5f55\u65f6\uff0chttps\u63d0\u793a\u975e\u79c1\u5bc6\u94fe\u63a5\uff0c\u5e76\u4e14\u6ca1\u6709\u9ad8\u7ea7\u9009\u9879"),(0,r.kt)("li",{parentName:"ol"},"\u754c\u9762\u6c49\u5316\u95ee\u9898")),(0,r.kt)("p",null,"http\u8bbf\u95ee\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://www.cnblogs.com/chen2ha/p/17086962.html"},"https://www.cnblogs.com/chen2ha/p/17086962.html")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"Usage of /dashboard:\n      --alsologtostderr                  log to standard error as well as files\n      --api-log-level string             level of API request logging, should be one of 'NONE', 'INFO' or 'DEBUG' (default \"INFO\")\n      --apiserver-host string            address of the Kubernetes API server to connect to in the format of protocol://address:port, leave it empty if the binary runs inside cluster for local discovery attempt\n      --authentication-mode strings      enabled authentication options, supports 'token' and 'basic' that should only be used if Kubernetes API server has --authorization-mode=ABAC and --basic-auth-file flags set (default [token])\n      --auto-generate-certificates       enables automatic certificates generation used to serve HTTPS\n      --bind-address ip                  IP address on which to serve the --port, set to 0.0.0.0 for all interfaces (default 0.0.0.0)\n      --default-cert-dir string          directory path containing files from --tls-cert-file and --tls-key-file, used also when auto-generating certificates flag is set (default \"/certs\")\n      --disable-settings-authorizer      disables settings page user authorizer so anyone can access settings page\n      --enable-insecure-login            enables login view when the app is not served over HTTPS\n      --enable-skip-login                enables skip button on the login page\n      --heapster-host string             address of the Heapster API server to connect to in the format of protocol://address:port, leave it empty if the binary runs inside cluster for service proxy usage\n      --insecure-bind-address ip         IP address on which to serve the --insecure-port, set to 127.0.0.1 for all interfaces (default 127.0.0.1)\n      --insecure-port int                port to listen to for incoming HTTP requests (default 9090)\n      --kubeconfig string                path to kubeconfig file with authorization and master location information\n      --locale-config string             path to file containing the locale configuration (default \"./locale_conf.json\")\n      --log_backtrace_at traceLocation   when logging hits line file:N, emit a stack trace (default :0)\n      --log_dir string                   If non-empty, write log files in this directory\n      --logtostderr                      log to standard error instead of files\n      --metric-client-check-period int   time interval between separate metric client health checks in seconds (default 30)\n      --metrics-provider string          select provider type for metrics, 'none' will not check metrics (default \"sidecar\")\n      --namespace string                 if non-default namespace is used encryption key will be created in the specified namespace (default \"kube-system\")\n      --port int                         secure port to listen to for incoming HTTPS requests (default 8443)\n      --sidecar-host string              address of the Sidecar API server to connect to in the format of protocol://address:port, leave it empty if the binary runs inside cluster for service proxy usage\n      --stderrthreshold severity         logs at or above this threshold go to stderr (default 2)\n      --system-banner string             system banner message displayed in the app if non-empty, it accepts simple HTML\n      --system-banner-severity string    severity of system banner, should be one of 'INFO', 'WARNING' or 'ERROR' (default \"INFO\")\n      --tls-cert-file string             file containing the default x509 certificate for HTTPS\n      --tls-key-file string              file containing the default x509 private key matching --tls-cert-file\n      --token-ttl int                    expiration time in seconds of JWE tokens generated by dashboard, set to 0 to avoid expiration (default 900)\n  -v, --v Level                          log level for V logs\n      --vmodule moduleSpec               comma-separated list of pattern=N settings for file-filtered logging\n")))}p.isMDXComponent=!0}}]);